GHEADER={};GHEADER.CORE={};GHEADER.CORE.ObjectRegistry={};GHEADER.CORE.uniqId=function(a){a=a||"";return a+(Math.ceil(Math.random()*1000000000)).toString()};GHEADER.CORE.AjaxModel=function(a,b){this.rsp=a;this.delegate=b;this.delegate.ajaxEnd=this.delegate.ajaxEnd||function(){};this.delegate.ajaxSuccess=this.delegate.ajaxSuccess||function(){};this.delegate.ajaxStart=this.delegate.ajaxStart||function(){}};GHEADER.CORE.AjaxModel.PROTO=function(){this.query=function(b,a){a=a||{};this.delegate.ajaxStart(b,a);$.ajax({type:"POST",url:this.rsp,data:{params:JSON.stringify(a),command:b},context:this.delegate,success:function(c){this.ajaxSuccess(b,c)},complete:function(c){this.ajaxEnd(b,c)},dataType:"json"})}};GHEADER.CORE.AjaxModel.prototype=new GHEADER.CORE.AjaxModel.PROTO();GHEADER.CORE.UploadModel=function(a,b){this.rsp=a;this.delegate=b;this.fakeIframe=null;this.uniqId=GHEADER.CORE.uniqId("uploadModel");GHEADER.CORE.ObjectRegistry[this.uniqId]=this};GHEADER.CORE.UploadModel.PROTO=function(){this.upload=function(a,d){d=d||{};var c,b;b=$(a).parent();this.fakeIframe=$('<iframe id="iframe-'+this.uniqId+'" name="attachmentHandler" style="display: none"></iframe>');c=$('<form enctype="multipart/form-data" method="POST" target="attachmentHandler" style="display: none"></form>');c.attr("action",this.rsp);c.append('<input type="hidden" name="uniqId" value="'+this.uniqId+'"/>');c.append('<input type="hidden" name="query" value=\''+JSON.stringify(d)+"' />");c.append(a);$("body").prepend(c).prepend(this.fakeIframe);this.delegate.uploadStart(d);c.get(0).submit();b.append(a);c.remove()};this.uploadComplete=function(a){this.fakeIframe.remove();if(a.type!=="upload"){try{this.delegate.uploadSuccess(a)}catch(b){alert(b)}}this.delegate.uploadEnd(a)}};GHEADER.CORE.UploadModel.prototype=new GHEADER.CORE.UploadModel.PROTO();GHEADER.bindDrag=function(b,h){b=$(b);if(b.data.uhDrag){b.data.uhDrag.setDelegate(h);return b.data.uhDrag}var f=h;var g={};var j=function(o,l){var k=true,m=false;var n={target:b,position:l,preventDefault:function(){m=true}};if(f[o]){k=f[o].call(f,n)}return k===false?false:!m};g.setDelegate=function(k){f=k};var i=false,c=false;var e={x:0,y:0};var a={x:0,y:0};var d={mouseDown:function(k){c=true;e.y=0;e.x=0;a.y=k.pageY;a.x=k.pageX;if(!j("start",e)){c=false}},mouseMove:function(l){if(!c){return}i=true;var k={x:l.pageX-a.x,y:l.pageY-a.y};if(j("drag",k)){e=k}},mouseUp:function(){if(!c){return}c=false;i=false;j("end",e)}};b.mousedown(d.mouseDown);$(document.body).mousemove(d.mouseMove);$(document.body).mouseup(d.mouseUp);$(document.body).on("selectstart",function(){return !i});b.attr("unselectable","on").css("user-select","none").on("selectstart",false)};GHEADER.CoverMenu=function(b){var a=$("#uh-upload-cover");a.change(function(){b.upload(a)});$("#uhco-reposition").click(function(){b.reposition()});$("#uhco-remove").click(function(){b.remove()});$("#uhco-choose").click(function(){b.choose()})};GHEADER.Cover=function(f,u){var e=f.userId;var m=f.groupId;var d=new GHEADER.CoverImage.nativeLauncher(f.cover.data);GHEADER.CoverImage.setLauncher(d);$(document).on("click","#uh-cover-image",function(){GHEADER.CoverImage.show()});if(f.viewOnlyMode){return}var c=true;var g=$("#uh-cover-image");var n=$("#uh-cover");var k=$("#uh-cover-overlay");var q=$(".uh-cover-add-btn-wrap .ow_context_action_block","#uhc-controls");var v={};v.position={top:0,left:0};v.canvas={height:n.height(),width:n.width()};v.userId=e;v.groupId=m;var b=function(x){if(g.attr("src")==x){return}var w=g.clone();w.attr("src",x);g.replaceWith(w);g=w;g.show();c=true;n.removeClass("uh-cover-no-cover");n.addClass("uh-cover-has-cover");q.addClass("ow_photo_context_action")};var i=function(w){g.hide();c=false;n.removeClass("uh-cover-has-cover");n.addClass("uh-cover-no-cover");q.removeClass("ow_photo_context_action")};var l="view";var h=function(w){n.removeClass("uh-cover-mode-"+l);l=w;n.addClass("uh-cover-mode-"+l);u.switchMode(w)};var t=function(w){n.find(".uh-scaler-img").css("width",w+"%")};var p,a={};a.uploadStart=function(w){h("loading")};a.uploadSuccess=function(w){if(w.message){OW.info(w.message)}if(w.src){b(w.src)}if(w.data){v.position.top=w.data.position.top;v.position.left=w.data.position.left;g.css(v.position);if(w.data.css){v.css=w.data.css;g.css(v.css)}}if(w.ratio){t(w.ratio)}h("reposition")};a.uploadEnd=function(w){if(w.type==="error"){h("view");OW.error(w.error)}};p=new GHEADER.CORE.UploadModel(f.uploader,a);var r,j={};j.$controls=$("#uhc-controls");j.ajaxStart=function(w){if(w==="removeCover"){return}if(w==="addFromPhotos"){h("loading");return}this.$controls.addClass("ow_preloader").addClass("uh-cover-controls-loading")};j.ajaxSuccess=function(x,w){if(w.type=="error"){OW.error(w.error);h("view");return}if(w.message){OW.info(w.message)}if(!w.src){i()}else{b(w.src)}if(w.data){v.position.top=w.data.position.top;v.position.left=w.data.position.left;g.css(v.position);if(w.data.css){v.css=w.data.css;g.css(v.css)}}if(x==="addFromPhotos"){h("reposition")}else{h("view")}if(w.ratio){t(w.ratio)}};j.ajaxEnd=function(w){if(w=="removeCover"){return}this.$controls.removeClass("ow_preloader").removeClass("uh-cover-controls-loading")};r=new GHEADER.CORE.AjaxModel(f.responder,j);var o={};o.upload=function(w){v.canvas.height=n.height();v.canvas.width=n.width();v.userId=e;v.groupId=m;p.upload(w,{height:n.height(),width:n.width(),userId:v.userId,groupId:v.groupId})};o.reposition=function(){h("reposition")};o.remove=function(){if(!confirm(OW.getLanguageText("gheader","delete_cover_confirmation"))){return false}i();h("view");r.query("removeCover",v)};o.choose=function(){var w=$(window).height();var x;x=OW.ajaxFloatBox("GHEADER_CMP_MyPhotos",[{windowHeight:w}],{addClass:"uh-photo-floatbox",title:OW.getLanguageText("gheader","my_photos_title"),scope:{setPhoto:function(y){r.query("addFromPhotos",{photoId:y,userId:e,groupId:m,height:n.height(),width:n.width()});x.close()},close:function(){x.close()}}})};GHEADER.CoverMenu(o,v);var s={};s.startPosition={},s.dimension={},s.direction="all",s.image=s.css={top:parseInt(g.css("top")),left:parseInt(g.css("left"))};s.setPosition=function(w){if(typeof w.y!=="undefined"){this.css.top=w.y}if(typeof w.x!=="undefined"){this.css.left=w.x}g.css(this.css)};s.start=function(){if(!c){return false}var w=g.position();this.startPosition.y=w.top;this.startPosition.x=w.left;this.css={top:this.startPosition.y,left:this.startPosition.x};this.dimension.parentHeight=n.height();this.dimension.parentWidth=n.width();this.dimension.imageHeight=g.height();this.dimension.imageWidth=g.width()};s.drag=function(B){var A=this.startPosition.y+B.position.y;var z=this.startPosition.x+B.position.x;var w=-(this.dimension.imageHeight-(this.dimension.parentHeight+(-A)));var x=-(this.dimension.imageWidth-(this.dimension.parentWidth+(-z)));A=A>=0?0:A;z=z>=0?0:z;var y={};if(w<0){y.y=A}if(x<0){y.x=z}this.setPosition(y)};s.end=function(w){v.position.top=this.css.top;v.position.left=this.css.left};GHEADER.bindDrag(k,s);$("#uh-reposition-cancel").click(function(){r.query("cancelChanges",v)});$("#uh-reposition-save").click(function(){v.canvas.height=n.height();v.canvas.width=n.width();r.query("saveCover",v)})};GHEADER.Header=function(b){var d=b.userId;var c=b.groupId;var a=$("#uh-header");var e="view";var f=function(g){a.removeClass("uh-mode-"+e);e=g;a.addClass("uh-mode-"+e)};this.cover=new GHEADER.Cover(b.cover,{switchMode:function(g){if(g==="view"){f("view")}else{f("coverEdit")}}})};$(function(){var b=null;var a=function(){if(b){window.clearTimeout(b)}};$(".uh-at-more-wrap").hover(function(){a();$(this).find(".ow_tooltip").stop(true,true).show().animate({top:2,opacity:1},"fast");$(this).find(".ow_context_action").addClass("active")},function(){a();var c=$(this);b=window.setTimeout(function(){c.find(".ow_tooltip").stop(true,true).animate({top:-4,opacity:0},"fast",function(){$(this).hide()});c.find(".ow_context_action").removeClass("active")},200)})});GHEADER.CoverImage=(function(){var d;var b=function(e){d=e};var c=function(e){return d};var a=function(){d.show()};return{setLauncher:b,getLauncher:c,show:a}})();GHEADER.CoverImage.nativeLauncher=function(a){this.show=function(){OW.ajaxFloatBox("GHEADER_CMP_CoverView",[a.groupId],{layout:"empty"})}};GHEADER.CoverImage.photoLauncher=function(a){this.show=function(){}};GHEADER.PhotoSelector=function(i,f){var c=i.listFull;var e=$("#uhps-list");var h=$("#uhps-list-content");var d=$("#uhps-preloader");if(c){d.hide()}var b=function(){return h.find(".uh-photo").length};var g,a={};a.ajaxStart=function(j){d.css("visibility","visible")};a.ajaxSuccess=function(k,j){b=j.offset;if(j.listFull){c=true;d.hide()}if(j.list){h.append(j.list)}OW.addScroll(e)};a.ajaxEnd=function(j){d.css("visibility","hidden")};g=new GHEADER.CORE.AjaxModel(i.responder,a);$("#uhps-cancel").click(function(){f.close()});$(document).off("click.uhps");$(document).on("click.uhps",".uh-photo",function(){var j=$(this);f.setPhoto(j.data("id"))});e.on("jsp-arrow-change",function(k,n,j,m,l){if(c){return}if(j){g.query("loadMorePhotos",{offset:b()})}});OW.addScroll(e)};